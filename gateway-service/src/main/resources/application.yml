server:
  port: 8090

spring:
  application:
    name: gateway-service
  
  cloud:
    gateway:
      # Configuración global
      default-filters:
        - DedupeResponseHeader=Access-Control-Allow-Credentials Access-Control-Allow-Origin
      
      globalcors:
        cors-configurations:
          '[/**]':
            allowedOrigins: "*"
            allowedMethods:
              - GET
              - POST
              - PUT
              - DELETE
              - OPTIONS
              - PATCH
            allowedHeaders: "*"
            exposedHeaders:
              - Authorization
              - Content-Disposition
            maxAge: 3600
      
      # Rutas a los microservicios
      routes:
        # Auth Service - /api/auth/** -> /auth/**
        - id: auth-service
          uri: ${AUTH_SERVICE_URL:http://localhost:8080}
          predicates:
            - Path=/api/auth/**
          filters:
            - StripPrefix=1

        # User Service - /api/users/** -> /usuarios/**
        - id: user-service
          uri: ${USER_SERVICE_URL:http://localhost:8081}
          predicates:
            - Path=/api/usuarios/**
          filters:
            - StripPrefix=1

        # Inventory Service - Lotes
        - id: inventory-lotes
          uri: ${INVENTORY_SERVICE_URL:http://localhost:8082}
          predicates:
            - Path=/api/lotes/**
          filters:
            - StripPrefix=1

        # Inventory Service - Tandas
        - id: inventory-tandas
          uri: ${INVENTORY_SERVICE_URL:http://localhost:8082}
          predicates:
            - Path=/api/tandas/**
          filters:
            - StripPrefix=1

        # Sales Service
        - id: sales-service
          uri: ${SALES_SERVICE_URL:http://localhost:8083}
          predicates:
            - Path=/api/ventas/**
          filters:
            - StripPrefix=1

        # Billing Service
        - id: billing-service
          uri: ${BILLING_SERVICE_URL:http://localhost:8084}
          predicates:
            - Path=/api/cuadres/**
          filters:
            - StripPrefix=1

        # Finance Service - Configuración
        - id: finance-config
          uri: ${FINANCE_SERVICE_URL:http://localhost:8085}
          predicates:
            - Path=/api/configuracion/**
          filters:
            - StripPrefix=1

        # Finance Service - Fondo
        - id: finance-fondo
          uri: ${FINANCE_SERVICE_URL:http://localhost:8085}
          predicates:
            - Path=/api/fondo/**
          filters:
            - StripPrefix=1

        # Finance Service - Costos Producción
        - id: finance-costos
          uri: ${FINANCE_SERVICE_URL:http://localhost:8085}
          predicates:
            - Path=/api/costos-produccion/**
          filters:
            - StripPrefix=1

        # Equipment Service - Equipos
        - id: equipment-equipos
          uri: ${EQUIPMENT_SERVICE_URL:http://localhost:8086}
          predicates:
            - Path=/api/equipos/**
          filters:
            - StripPrefix=1

        # Equipment Service - Mensualidades
        - id: equipment-mensualidades
          uri: ${EQUIPMENT_SERVICE_URL:http://localhost:8086}
          predicates:
            - Path=/api/mensualidades/**
          filters:
            - StripPrefix=1

        # Document Service
        - id: document-service
          uri: ${DOCUMENT_SERVICE_URL:http://localhost:8087}
          predicates:
            - Path=/api/documentos/**
          filters:
            - StripPrefix=1

        # Notification Service
        - id: notification-service
          uri: ${NOTIFICATION_SERVICE_URL:http://localhost:8088}
          predicates:
            - Path=/api/notificaciones/**
          filters:
            - StripPrefix=1

        # Backup Service
        - id: backup-service
          uri: ${BACKUP_SERVICE_URL:http://localhost:8089}
          predicates:
            - Path=/api/backups/**
          filters:
            - StripPrefix=1

# Actuator
management:
  endpoints:
    web:
      exposure:
        include: health,info,gateway
  endpoint:
    gateway:
      enabled: true

# Logging
logging:
  level:
    org.springframework.cloud.gateway: INFO
    com.trabix: DEBUG