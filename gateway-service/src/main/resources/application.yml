server:
  port: 8090

spring:
  application:
    name: gateway-service
  
  cloud:
    gateway:
      # Configuración global
      default-filters:
        - DedupeResponseHeader=Access-Control-Allow-Credentials Access-Control-Allow-Origin
      
      globalcors:
        cors-configurations:
          '[/**]':
            allowedOrigins: "*"
            allowedMethods:
              - GET
              - POST
              - PUT
              - DELETE
              - OPTIONS
              - PATCH
            allowedHeaders: "*"
            exposedHeaders:
              - Authorization
              - Content-Disposition
            maxAge: 3600
      
      # Rutas a los microservicios
      routes:
        # Auth Service
        - id: auth-service
          uri: ${AUTH_SERVICE_URL:http://localhost:8080}
          predicates:
            - Path=/api/auth/**
          filters:
            - RewritePath=/api/auth/(?<segment>.*), /auth/${segment}
        
        # User Service
        - id: user-service
          uri: ${USER_SERVICE_URL:http://localhost:8081}
          predicates:
            - Path=/api/users/**
          filters:
            - RewritePath=/api/users/(?<segment>.*), /usuarios/${segment}
        
        # Inventory Service - Lotes
        - id: inventory-lotes
          uri: ${INVENTORY_SERVICE_URL:http://localhost:8082}
          predicates:
            - Path=/api/inventory/lotes/**
          filters:
            - RewritePath=/api/inventory/lotes/(?<segment>.*), /lotes/${segment}
        
        # Inventory Service - Tandas
        - id: inventory-tandas
          uri: ${INVENTORY_SERVICE_URL:http://localhost:8082}
          predicates:
            - Path=/api/inventory/tandas/**
          filters:
            - RewritePath=/api/inventory/tandas/(?<segment>.*), /tandas/${segment}
        
        # Sales Service
        - id: sales-service
          uri: ${SALES_SERVICE_URL:http://localhost:8083}
          predicates:
            - Path=/api/sales/**
          filters:
            - RewritePath=/api/sales/(?<segment>.*), /ventas/${segment}
        
        # Billing Service
        - id: billing-service
          uri: ${BILLING_SERVICE_URL:http://localhost:8084}
          predicates:
            - Path=/api/billing/**
          filters:
            - RewritePath=/api/billing/(?<segment>.*), /cuadres/${segment}
        
        # Finance Service - Configuración
        - id: finance-config
          uri: ${FINANCE_SERVICE_URL:http://localhost:8085}
          predicates:
            - Path=/api/finance/config/**
          filters:
            - RewritePath=/api/finance/config/(?<segment>.*), /configuracion/${segment}
        
        # Finance Service - Fondo
        - id: finance-fondo
          uri: ${FINANCE_SERVICE_URL:http://localhost:8085}
          predicates:
            - Path=/api/finance/fondo/**
          filters:
            - RewritePath=/api/finance/fondo/(?<segment>.*), /fondo/${segment}
        
        # Finance Service - Costos Producción
        - id: finance-costos
          uri: ${FINANCE_SERVICE_URL:http://localhost:8085}
          predicates:
            - Path=/api/finance/costos/**
          filters:
            - RewritePath=/api/finance/costos/(?<segment>.*), /costos-produccion/${segment}
        
        # Equipment Service - Equipos
        - id: equipment-equipos
          uri: ${EQUIPMENT_SERVICE_URL:http://localhost:8086}
          predicates:
            - Path=/api/equipment/equipos/**
          filters:
            - RewritePath=/api/equipment/equipos/(?<segment>.*), /equipos/${segment}
        
        # Equipment Service - Mensualidades
        - id: equipment-mensualidades
          uri: ${EQUIPMENT_SERVICE_URL:http://localhost:8086}
          predicates:
            - Path=/api/equipment/mensualidades/**
          filters:
            - RewritePath=/api/equipment/mensualidades/(?<segment>.*), /mensualidades/${segment}
        
        # Document Service
        - id: document-service
          uri: ${DOCUMENT_SERVICE_URL:http://localhost:8087}
          predicates:
            - Path=/api/documents/**
          filters:
            - RewritePath=/api/documents/(?<segment>.*), /documentos/${segment}
        
        # Notification Service
        - id: notification-service
          uri: ${NOTIFICATION_SERVICE_URL:http://localhost:8088}
          predicates:
            - Path=/api/notifications/**
          filters:
            - RewritePath=/api/notifications/(?<segment>.*), /notificaciones/${segment}
        
        # Backup Service
        - id: backup-service
          uri: ${BACKUP_SERVICE_URL:http://localhost:8089}
          predicates:
            - Path=/api/backups/**
          filters:
            - RewritePath=/api/backups/(?<segment>.*), /backups/${segment}

# Actuator
management:
  endpoints:
    web:
      exposure:
        include: health,info,gateway
  endpoint:
    gateway:
      enabled: true

# Logging
logging:
  level:
    org.springframework.cloud.gateway: INFO
    com.trabix: DEBUG
